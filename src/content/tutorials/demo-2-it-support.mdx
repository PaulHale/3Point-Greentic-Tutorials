---
title: "Demo 2: IT Support Assistant"
description: Build an intelligent IT support assistant using MCP tool integration and conditional routing.
difficulty: intermediate
duration: "45 minutes"
prerequisites:
  - Completed Demo 1 (Hello World)
  - OpenAI API key
  - Understanding of YAML
order: 2
---

import CodeBlock from '@/components/tutorial/CodeBlock';
import Terminal from '@/components/tutorial/Terminal';
import Callout from '@/components/ui/Callout.astro';

# IT Support Assistant

In this tutorial, you'll build a realistic IT support assistant that can:

- Collect issue details through structured Q&A
- Classify requests using an LLM via MCP
- Route to different handlers based on classification
- Respond with contextual help

## Architecture Overview

Here's what we're building:

import { ITSupportFlowDiagram } from '@/components/diagrams/ITSupportFlowDiagram';

<ITSupportFlowDiagram client:visible className="my-6" />

## Set Up Your Project

Create a new project directory:

<Terminal
  client:visible
  lines={[
    { type: 'command', content: 'mkdir it-support && cd it-support' },
    { type: 'command', content: 'mkdir flows' },
  ]}
/>

## Configure Secrets

The LLM component needs an API key. Set up your environment:

<CodeBlock
  client:visible
  filename=".env"
  language="bash"
  code={`OPENAI_API_KEY=sk-your-api-key-here`}
/>

<Callout type="warning" title="Keep Secrets Safe">
  Never commit `.env` files to version control. Add `.env` to your `.gitignore`.
</Callout>

## Create the Flow

Create a new flow file:

<Terminal
  client:visible
  lines={[
    { type: 'command', content: 'greentic-flow new --flow flows/support.ygtc --id it-support --type messaging --name "IT Support Assistant"' },
    { type: 'success', content: "✓ Created flows/support.ygtc" },
  ]}
/>

Now build out the complete flow:

<CodeBlock
  client:visible
  filename="flows/support.ygtc"
  language="yaml"
  code={`id: it-support
title: IT Support Assistant
description: Intelligent IT support with LLM classification
type: messaging
start: greet

parameters:
  llm_model: gpt-4o

nodes:
  greet:
    templating.handlebars:
      text: |
        Welcome to IT Support!
        I can help with password resets, hardware issues,
        software problems, and more.

        Please describe your issue.
    routing:
      - to: collect_info`}
/>

## Add Issue Collection

The `qa.process` operation collects structured information:

<CodeBlock
  client:visible
  filename="flows/support.ygtc (continued)"
  language="yaml"
  highlightLines={[3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]}
  code={`  collect_info:
    qa.process:
      questions:
        - id: issue_description
          prompt: "Please describe your issue in detail:"
          answer_type: text
          required: true
        - id: urgency
          prompt: "How urgent is this?"
          answer_type: choice
          options:
            - Low - Can wait a few days
            - Medium - Need help today
            - High - Blocking my work
            - Critical - System down
    routing:
      - to: classify`}
/>

The `qa.process` operation:

- Presents questions one at a time
- Validates required fields
- Supports different answer types (text, choice, etc.)
- Outputs responses accessible via `{{in.issue_description}}` (using the question id)

## Add LLM Classification

Use `mcp.exec` to call an LLM for intelligent classification:

<CodeBlock
  client:visible
  filename="flows/support.ygtc (continued)"
  language="yaml"
  highlightLines={[3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]}
  code={`  classify:
    mcp.exec:
      component: llm
      action: chat
      args:
        model: parameters.llm_model
        temperature: 0
        system: |
          You are an IT support classifier. Analyse the user's issue and
          classify it into exactly one of these categories:

          - password: Password reset, login issues, MFA problems
          - hardware: Physical equipment, monitors, keyboards, mice
          - software: Application errors, installation, updates
          - network: WiFi, VPN, connectivity issues
          - other: Anything that doesn't fit above

          Respond with ONLY the category name, nothing else.
        user: "Issue: {{in.issue_description}}"
    routing:
      - to: password_handler
      - to: hardware_handler
      - to: software_handler
      - to: network_handler
      - to: general_handler`}
/>

Key points:

- **`mcp.exec`** — Executes MCP tools (here, calling an LLM)
- **`temperature: 0`** — Makes the LLM deterministic for classification
- **`parameters.llm_model`** — References the flow parameter
- **Multiple routes** — All handlers receive the classification result

## Add Category Handlers

Each handler uses `when` to conditionally execute based on the classification:

### Password Handler

<CodeBlock
  client:visible
  filename="flows/support.ygtc (continued)"
  language="yaml"
  code={`  password_handler:
    when:
      expression: "{{classify.payload.text}} == 'password'"
    templating.handlebars:
      text: |
        I can help you reset your password.

        Please visit our secure password reset portal:
        https://password.company.com/reset

        If you're having trouble with MFA, contact the security team
        at security@company.com.

        Is there anything else I can help with?
    routing:
      - out: true`}
/>

### Hardware Handler

<CodeBlock
  client:visible
  filename="flows/support.ygtc (continued)"
  language="yaml"
  code={`  hardware_handler:
    when:
      expression: "{{classify.payload.text}} == 'hardware'"
    templating.handlebars:
      text: |
        I'll create a hardware support ticket for you.

        **Issue:** {{in.issue_description}}
        **Urgency:** {{in.urgency}}

        A technician will contact you within:
        - Critical: 1 hour
        - High: 4 hours
        - Medium/Low: 24 hours

        Your ticket reference: HW-{{timestamp}}
    routing:
      - out: true`}
/>

### Software Handler with LLM Assistance

<CodeBlock
  client:visible
  filename="flows/support.ygtc (continued)"
  language="yaml"
  code={`  software_handler:
    when:
      expression: "{{classify.payload.text}} == 'software'"
    mcp.exec:
      component: llm
      action: chat
      args:
        model: parameters.llm_model
        temperature: 0.7
        system: |
          You are a helpful IT support agent specialising in software issues.
          Provide clear, step-by-step troubleshooting guidance.
          Keep responses concise but helpful.
          If you can't resolve the issue, explain how to escalate.
        user: |
          User issue: {{in.issue_description}}

          Please provide troubleshooting steps.
    routing:
      - to: respond_software`}
/>

### Network Handler

<CodeBlock
  client:visible
  filename="flows/support.ygtc (continued)"
  language="yaml"
  code={`  network_handler:
    when:
      expression: "{{classify.payload.text}} == 'network'"
    templating.handlebars:
      text: |
        Let me check some common network issues:

        1. **VPN Issues:** Try disconnecting and reconnecting
        2. **WiFi Problems:** Forget the network and rejoin
        3. **Slow Internet:** Run a speed test at speedtest.net

        If these don't help, I'll connect you with the network team.
    routing:
      - to: ask_resolved`}
/>

### General Handler (Fallback)

<CodeBlock
  client:visible
  filename="flows/support.ygtc (continued)"
  language="yaml"
  code={`  general_handler:
    when:
      expression: "{{classify.payload.text}} != 'password' && {{classify.payload.text}} != 'hardware' && {{classify.payload.text}} != 'software' && {{classify.payload.text}} != 'network'"
    mcp.exec:
      component: llm
      action: chat
      args:
        model: parameters.llm_model
        system: You are a helpful IT support assistant. Be friendly and thorough.
        user: "Please help with: {{in.issue_description}}"
    routing:
      - to: respond_general`}
/>

## Add Response Nodes

<CodeBlock
  client:visible
  filename="flows/support.ygtc (continued)"
  language="yaml"
  code={`  respond_software:
    templating.handlebars:
      text: "{{software_handler.payload.text}}"
    routing:
      - to: ask_resolved

  respond_general:
    templating.handlebars:
      text: "{{general_handler.payload.text}}"
    routing:
      - to: ask_resolved`}
/>

## Add Follow-up Flow

Ask if the issue was resolved and handle accordingly:

<CodeBlock
  client:visible
  filename="flows/support.ygtc (continued)"
  language="yaml"
  code={`  ask_resolved:
    qa.process:
      questions:
        - id: resolved
          prompt: "Did this resolve your issue?"
          answer_type: choice
          options:
            - Yes, thank you!
            - No, I need more help
    routing:
      - to: close_resolved
      - to: escalate

  close_resolved:
    when:
      expression: "{{in.resolved}} == 'Yes, thank you!'"
    templating.handlebars:
      text: |
        Great! I'm glad I could help.

        If you have any other issues, just start a new conversation.
        Have a great day!
    routing:
      - out: true

  escalate:
    when:
      expression: "{{in.resolved}} != 'Yes, thank you!'"
    templating.handlebars:
      text: |
        I'll escalate this to a human agent.

        **Ticket Created:** ESC-{{timestamp}}
        **Category:** {{classify.payload.text}}
        **Issue:** {{in.issue_description}}
        **Urgency:** {{in.urgency}}

        A support specialist will contact you within 30 minutes.
    routing:
      - out: true`}
/>

## Complete Flow

Here's the full flow file for reference:

<CodeBlock
  client:visible
  filename="flows/support.ygtc (complete)"
  language="yaml"
  showLineNumbers={false}
  code={`id: it-support
title: IT Support Assistant
description: Intelligent IT support with LLM classification
type: messaging
start: greet

parameters:
  llm_model: gpt-4o

nodes:
  greet:
    templating.handlebars:
      text: |
        Welcome to IT Support!
        I can help with password resets, hardware issues,
        software problems, and more.

        Please describe your issue.
    routing:
      - to: collect_info

  collect_info:
    qa.process:
      questions:
        - id: issue_description
          prompt: "Please describe your issue in detail:"
          answer_type: text
          required: true
        - id: urgency
          prompt: "How urgent is this?"
          answer_type: choice
          options:
            - Low - Can wait a few days
            - Medium - Need help today
            - High - Blocking my work
            - Critical - System down
    routing:
      - to: classify

  classify:
    mcp.exec:
      component: llm
      action: chat
      args:
        model: parameters.llm_model
        temperature: 0
        system: |
          Classify the IT issue into: password, hardware, software, network, or other.
          Respond with ONLY the category name.
        user: "Issue: {{in.issue_description}}"
    routing:
      - to: password_handler
      - to: hardware_handler
      - to: software_handler
      - to: network_handler
      - to: general_handler

  password_handler:
    when:
      expression: "{{classify.payload.text}} == 'password'"
    templating.handlebars:
      text: |
        I can help you reset your password.
        Please visit: https://password.company.com/reset
    routing:
      - out: true

  hardware_handler:
    when:
      expression: "{{classify.payload.text}} == 'hardware'"
    templating.handlebars:
      text: |
        I'll create a hardware support ticket.
        Issue: {{in.issue_description}}
        A technician will contact you within 24 hours.
    routing:
      - out: true

  software_handler:
    when:
      expression: "{{classify.payload.text}} == 'software'"
    mcp.exec:
      component: llm
      action: chat
      args:
        model: parameters.llm_model
        system: You are a helpful IT support agent for software issues.
        user: "Help with: {{in.issue_description}}"
    routing:
      - to: respond_software

  network_handler:
    when:
      expression: "{{classify.payload.text}} == 'network'"
    templating.handlebars:
      text: |
        Common network fixes:
        1. VPN: Disconnect and reconnect
        2. WiFi: Forget network and rejoin
        3. Speed: Test at speedtest.net
    routing:
      - to: ask_resolved

  general_handler:
    when:
      expression: "{{classify.payload.text}} == 'other'"
    mcp.exec:
      component: llm
      action: chat
      args:
        model: parameters.llm_model
        system: You are a helpful IT support assistant.
        user: "Help with: {{in.issue_description}}"
    routing:
      - to: respond_general

  respond_software:
    templating.handlebars:
      text: "{{software_handler.payload.text}}"
    routing:
      - to: ask_resolved

  respond_general:
    templating.handlebars:
      text: "{{general_handler.payload.text}}"
    routing:
      - to: ask_resolved

  ask_resolved:
    qa.process:
      questions:
        - id: resolved
          prompt: "Did this resolve your issue?"
          answer_type: choice
          options:
            - Yes, thank you!
            - No, I need more help
    routing:
      - to: close_resolved
      - to: escalate

  close_resolved:
    when:
      expression: "{{in.resolved}} == 'Yes, thank you!'"
    templating.handlebars:
      text: "Great! Glad I could help. Have a great day!"
    routing:
      - out: true

  escalate:
    when:
      expression: "{{in.resolved}} != 'Yes, thank you!'"
    templating.handlebars:
      text: "Escalating to a human agent. Ticket: ESC-{{timestamp}}"
    routing:
      - out: true`}
/>

## Test Your Flow

<Terminal
  client:visible
  lines={[
    { type: 'command', content: 'greentic-flow doctor flows/support.ygtc' },
    { type: 'success', content: "✓ Flow 'it-support' is valid" },
    { type: 'command', content: 'greentic-pack build --in . --gtpack-out dist/support.gtpack' },
    { type: 'success', content: '✓ Pack built: dist/support.gtpack' },
    { type: 'command', content: 'greentic-dev pack run --pack dist/support.gtpack' },
    { type: 'success', content: 'Welcome to IT Support! ...', delay: 500 },
    { type: 'command', content: "I forgot my password and can't log in", delay: 1000 },
    { type: 'output', content: 'Please describe your issue in detail:', delay: 500 },
    { type: 'output', content: "> I forgot my password and can't log into my laptop", delay: 500 },
    { type: 'output', content: 'How urgent is this?', delay: 500 },
    { type: 'output', content: '> High - Blocking my work', delay: 500 },
    { type: 'output', content: 'Classifying issue...', delay: 500 },
    { type: 'success', content: 'I can help you reset your password. Please visit: https://password.company.com/reset', delay: 1000 },
  ]}
/>

## What You Learned

In this tutorial, you learned:

- ✅ Structured Q&A collection with `qa.process`
- ✅ LLM integration via `mcp.exec`
- ✅ Conditional routing with `when` expressions
- ✅ Flow parameters with `parameters:`
- ✅ Referencing previous node output
- ✅ Multi-branch routing patterns
- ✅ Follow-up flows and escalation

## Next Steps

Ready for the advanced tutorial?

- **[Demo 3: RAG System](/tutorials/demo-3-rag-system)** — Build a full-stack knowledge base
- **[Messaging Channels](/docs/messaging/overview)** — Deploy to Teams, Slack, etc.
- **[MCP Integration](/docs/mcp/overview)** — Connect to external tools
